FROM node:18-alpine

WORKDIR /app

# Copy everything
COPY . .

# Install pnpm
RUN npm install -g pnpm

# Install dependencies
RUN pnpm install

# Build API
RUN pnpm --filter @eventscrape/api build

# Debug: Check what was built
RUN ls -la apps/api/
RUN ls -la apps/api/dist/ || echo "dist directory not found"

EXPOSE 3001
CMD ["node", "apps/api/dist/server.js"]